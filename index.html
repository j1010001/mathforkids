<html>
<head>
  <style>

    .button:hover {
      background-color: lightgreen;
    }

    div {
      margin:auto;
      text-align:center;
    }

    .meter {
      height: 20px;  /* Can be anything */
      position: relative;
      background: rgb(70,70,70);
      border-radius: 25px;
      padding: 7px;

    }

    .meter > span {
      display: block;
      height: 100%;
      border-top-right-radius: 20px;
      border-bottom-right-radius: 20px;
      border-top-left-radius: 20px;
      border-bottom-left-radius: 20px;
      background-color: rgb(43,194,83);
      position: relative;

    }

    #problem_solving_area {
      width:50%;
    }

  </style>
</head>
<body>

  <div id="problem_setup_area">
    problem setup
    <br>
    max number to use:<input id="problem_setup_max_num" type="number">
    <br>
    how many problems will you solve:<input id="problem_setup_num_of_probs" type="number">
    <br>
    <button class="button" id="problem_setup_button" type="button">start</button>
  </div>
  <div id="problem_solving_area">
    <div class="meter">
      <span id="meter_span" style="width: 0%"></span>
    </div>
    <div id="problem"></div>
    <div id="response">
      <input id="response_input" type="text">
      <button class="button" id="response_button" type="button">that's it I am sure</button>
    </div>
    <div id="result"></div>
    <div id="keyboard"></div>
  </div>
  <div id="result_area">
  </div>
  <script>


    var generate_problem = function(problem_setup, problem) {
        problem.a = Math.floor(Math.random() * problem_setup.max_num);
        problem.b = Math.floor(Math.random() * problem_setup.max_num);
        problem.type = Math.floor(Math.random() * 10) % 2;

        switch(problem.type) {
          case 1:
            problem.type = "+";
            break;
          default:
            problem.type = "-";
            break;
        }
        console.log("a: " + problem.a + " b: " + problem.b + "type:" + problem.type);

        var problem_element = document.getElementById("problem");

        problem_element.textContent = problem.a + " " + problem.type + " " + problem.b;

        window.requestAnimationFrame(get_response);
    }

    var get_response = function() {
      //var response = prompt("type the result");
      return Number(document.getElementById("response_input").value);

    }

    var evaluate_response = function(problem, response) {
      var result = false;
      switch (problem.type) {
        case "+":
          if((problem.a + problem.b) == response)
            result = true;

        case "-":
          if((problem.a - problem.b) == response)
            result = true;
      }

      return result;
    }

    var display_results = function(results) {
      var results_element = document.getElementById("result_area");
      var content;
      var i;
      var correct_answers = 0;
      for(i=0;i<results.length;i++) {
        var p = document.createElement("p");
        content = document.createTextNode(results[i].a + " " + results[i].type + " " + results[i].b + " = " + results[i].response);
        p.appendChild(content);
        if(results[i].result == true) {
          correct_answers++;
        }
        else {
          p.style.color = "red";
        }
        results_element.appendChild(p);
      }
      results_element.innerHTML += "<br>";
      var p = document.createElement("p");
      content = document.createTextNode("You got " + correct_answers + " out of " + results.length + " right.");
      p.appendChild(content);
      results_element.appendChild(p);
    }

    var init = function() {
      console.log("Initializing ...");

      function problem(a, b, type, result, response) {
          this.a = a;
          this.b = b;
          this.type = type;
          this.result = result;
          this.response = response;
      }
      var probs_solved_counter = 0;
      var problem_setup = {};
      var result;
      var results = [];
      var p;

      //hide the problem solving are until problem setup is done
      document.getElementById("problem_solving_area").style.visibility = "hidden";

      //when setup is done hide the problem setup and expose the problem solution area
      document.getElementById("problem_setup_button").addEventListener("click", function() {
        console.log("Problem setup done ...");
        problem_setup.max_num = document.getElementById("problem_setup_max_num").value;
        problem_setup.num_of_probs = document.getElementById("problem_setup_num_of_probs").value;

        document.getElementById("problem_setup_area").style.visibility = "hidden";
        document.getElementById("problem_solving_area").style.visibility = "visible";

        generate_problem(problem_setup, p = new problem());
      });

      document.getElementById("response_button").addEventListener("click", function() {
        var response = get_response();
        result = evaluate_response(p, response);

        var result_element = document.getElementById("result");
        if(result == true)
        {
            result_element.textContent = "That's right, Well done!";
        }
        else {
            result_element.textContent = "Oh Oh ... try again";
        }

        //save the problem and the solution
        p.response = response;
        p.result = result;
        results.push(p);
        probs_solved_counter++;
        if(probs_solved_counter < problem_setup.num_of_probs)
        {
          //update the progress meter

          document.getElementById("meter_span").style.width = ((probs_solved_counter/problem_setup.num_of_probs)*100) + "%";
          generate_problem(problem_setup, p = new problem());
        }
        else {
          //exercise done, hide problem solution area, show results
          document.getElementById("problem_solving_area").style.visibility = "hidden";
          display_results(results);
          console.log("finished!");
        }
      });
    }

  window.addEventListener("load", init());

  </script>
</body>
</html>
